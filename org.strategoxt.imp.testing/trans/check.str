module check

imports
  libstratego-lib
  libstratego-aterm
  include/Spoofax-Testing
  lib/editor-common.generated
  aterm-eq
  spoofax_testing
  file-resolving
  
rules
  constraint-note = fail
  
  constraint-warning:
    parse-test(_,description(d), i, e) -> (d, $[Test fails])
    where
      input := <parse-test-get-input>i
    ; expected := <parse-test-get-expected>e  
    ; exploded := <explode-aterm>input
    where
      not(<aterm-eq>(exploded, expected))

  constraint-warning:
    parse-test(_,description(d), i, failure()) -> (d, $[Test fails])
    where
      <parse-test-get-input>i

  parse-test-get-input :
    file(f) -> <resolve-path(|<current-path>) ; read-text-file ; spt-parse-string>f
    
  parse-test-get-input :
    string(_,s,_) -> <spt-parse-string>s

  parse-test-get-expected :
    pattern(p) -> p

  parse-test-get-expected :
    success() -> wildcard()

  parse-test-get-expected :
    file(f) -> <resolve-path(|<current-path>) ; ReadFromFile; explode-aterm>f

 
    